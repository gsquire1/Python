<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Raritan PX2/PX3 JSON-RPC API: Perl JSON-RPC Client Binding</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Raritan PX2/PX3 JSON-RPC API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Rules and Mechanism for Mapping PX2/EMX-IDL to JSON-RPC</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Perl JSON-RPC Client Binding </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Pre-Requirements</h2>
<p>Raritan's JSON-RPC Perl bindings require the following perl packages:</p>
<ul>
<li>LWP::Protocol::https</li>
<li>LWP::UserAgent</li>
<li>HTTP::Request::Common</li>
<li>JSON</li>
<li>JSON::RPC::Common::Marshal::HTTP</li>
<li>Error</li>
<li>Data::Dumper</li>
<li>parent</li>
</ul>
<h3>Linux</h3>
<p>In yum-based Linux distributions the following command will install the required packages:</p>
<div class="fragment"><div class="line">yum install <span class="stringliteral">&quot;perl(LWP::Protocol::https)&quot;</span> <span class="stringliteral">&quot;perl(LWP::UserAgent)&quot;</span> \</div>
<div class="line">            <span class="stringliteral">&quot;perl(HTTP::Request::Common)&quot;</span> <span class="stringliteral">&quot;perl(JSON)&quot;</span> \</div>
<div class="line">            <span class="stringliteral">&quot;perl(JSON::RPC::Common::Marshal::HTTP)&quot;</span> <span class="stringliteral">&quot;perl(Error)&quot;</span> \</div>
<div class="line">            <span class="stringliteral">&quot;perl(Data::Dumper)&quot;</span> <span class="stringliteral">&quot;perl(parent)&quot;</span></div>
</div><!-- fragment --><h3>Windows</h3>
<p>There are various Perl distributions available for Windows (see <a href="http://perl.org/get.html">http://perl.org/get.html</a>). The bindings were tested with ActiveState Perl (<a href="http://www.activestate.com/activeperl/downloads">http://www.activestate.com/activeperl/downloads</a>). After installing ActiveState Perl, the required modules can be installed with the following command:</p>
<div class="fragment"><div class="line">ppm install LWP::Protocol::https LWP::UserAgent HTTP::Request::Common \</div>
<div class="line">            JSON JSON::RPC::Common::Marshal::HTTP Error Data::Dumper parent</div>
</div><!-- fragment --><h2>Examples</h2>
<h3>Getting device information:</h3>
<p>Code: </p>
<div class="fragment"><div class="line">use Raritan::RPC;</div>
<div class="line">use Data::Dumper;</div>
<div class="line"></div>
<div class="line">my $agent = <span class="keyword">new</span> Raritan::RPC::Agent(<span class="stringliteral">&#39;https://my-px.example.com&#39;</span>, <span class="stringliteral">&#39;admin&#39;</span>, <span class="stringliteral">&#39;raritan&#39;</span>);</div>
<div class="line">my $pdu = $agent-&gt;createProxy(<span class="stringliteral">&#39;/model/pdu/0&#39;</span>);</div>
<div class="line">my $metadata = $pdu-&gt;getMetaData();</div>
<div class="line">print Dumper($metadata);</div>
</div><!-- fragment --><p>Result: </p>
<div class="fragment"><div class="line">$VAR1 = {</div>
<div class="line">          <span class="stringliteral">&#39;hwRevision&#39;</span> =&gt; <span class="stringliteral">&#39;0x64&#39;</span>,</div>
<div class="line">          <span class="stringliteral">&#39;hasSwitchableOutlets&#39;</span> =&gt; 1,</div>
<div class="line">          <span class="stringliteral">&#39;hasLatchingOutletRelays&#39;</span> =&gt; 0,</div>
<div class="line">          <span class="stringliteral">&#39;isInlineMeter&#39;</span> =&gt; 0,</div>
<div class="line">          <span class="stringliteral">&#39;ctrlBoardSerial&#39;</span> =&gt; <span class="stringliteral">&#39;PKI9050003&#39;</span>,</div>
<div class="line">          <span class="stringliteral">&#39;hasMeteredOutlets&#39;</span> =&gt; 0,</div>
<div class="line">          <span class="stringliteral">&#39;fwRevision&#39;</span> =&gt; <span class="stringliteral">&#39;3.0.2.5-41550&#39;</span>,</div>
<div class="line">          <span class="stringliteral">&#39;nameplate&#39;</span> =&gt; {</div>
<div class="line">                           <span class="stringliteral">&#39;model&#39;</span> =&gt; <span class="stringliteral">&#39;PX2-2630U-A1&#39;</span>,</div>
<div class="line">                           <span class="stringliteral">&#39;imageFileURL&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line">                           <span class="stringliteral">&#39;manufacturer&#39;</span> =&gt; <span class="stringliteral">&#39;Raritan&#39;</span>,</div>
<div class="line">                           <span class="stringliteral">&#39;rating&#39;</span> =&gt; {</div>
<div class="line">                                         <span class="stringliteral">&#39;voltage&#39;</span> =&gt; <span class="stringliteral">&#39;360-415V&#39;</span>,</div>
<div class="line">                                         <span class="stringliteral">&#39;current&#39;</span> =&gt; <span class="stringliteral">&#39;24A&#39;</span>,</div>
<div class="line">                                         <span class="stringliteral">&#39;power&#39;</span> =&gt; <span class="stringliteral">&#39;15.0-17.3kVA&#39;</span>,</div>
<div class="line">                                         <span class="stringliteral">&#39;frequency&#39;</span> =&gt; <span class="stringliteral">&#39;50/60Hz&#39;</span></div>
<div class="line">                                       },</div>
<div class="line">                           <span class="stringliteral">&#39;partNumber&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line">                           <span class="stringliteral">&#39;serialNumber&#39;</span> =&gt; <span class="stringliteral">&#39;PKE0954001&#39;</span></div>
<div class="line">                         },</div>
<div class="line">          <span class="stringliteral">&#39;macAddress&#39;</span> =&gt; <span class="stringliteral">&#39;00:0d:5d:07:87:5c&#39;</span></div>
<div class="line">        };</div>
</div><!-- fragment --><h3>Power-cycling an outlet:</h3>
<div class="fragment"><div class="line">use Raritan::RPC;</div>
<div class="line"></div>
<div class="line">my $agent = <span class="keyword">new</span> Raritan::RPC::Agent(<span class="stringliteral">&#39;https://my-px.example.com&#39;</span>, <span class="stringliteral">&#39;admin&#39;</span>, <span class="stringliteral">&#39;raritan&#39;</span>);</div>
<div class="line">my $pdu = $agent-&gt;createProxy(<span class="stringliteral">&#39;/model/pdu/0&#39;</span>);</div>
<div class="line">my $outlets = $pdu-&gt;getOutlets();</div>
<div class="line">$outlets-&gt;[0]-&gt;cyclePowerState();</div>
</div><!-- fragment --><h3>Configuring the SNMP agent:</h3>
<div class="fragment"><div class="line">use Raritan::RPC;</div>
<div class="line"></div>
<div class="line">my $agent = <span class="keyword">new</span> Raritan::RPC::Agent(<span class="stringliteral">&#39;https://my-device.example.com&#39;</span>, <span class="stringliteral">&#39;admin&#39;</span>, <span class="stringliteral">&#39;raritan&#39;</span>);</div>
<div class="line">my $snmp_proxy = $agent-&gt;createProxy(<span class="stringliteral">&#39;/snmp&#39;</span>);</div>
<div class="line">my $config = $snmp_proxy-&gt;getConfiguration();</div>
<div class="line">$config-&gt;{v2enable} = 0;</div>
<div class="line">$config-&gt;{readComm} = <span class="stringliteral">&#39;public&#39;</span>;</div>
<div class="line">$config-&gt;{writeComm} = <span class="stringliteral">&#39;private&#39;</span>;</div>
<div class="line">$snmp_proxy-&gt;setConfiguration($config);</div>
</div><!-- fragment --><h2>IDL-to-Perl Mapping</h2>
<h3>IDL Modules and Perl Package Names</h3>
<p>All classes dealing with Raritan JSON-RPC communication are located in Perl packages starting with <code>Raritan::RPC</code>. All named sections in IDL files (<code>module</code>, <code>interface</code> and <code>enumeration</code>) provide a scope for their included identifiers and are added as further components to the Perl package name.</p>
<h3>Interfaces and Methods</h3>
<p>IDL interfaces are mapped to Perl proxy classes which provide all methods defined by the IDL interface and its bases. Perl methods require the same number of scalar arguments as defined in the IDL signature. Simple types like integers, strings or enumerations are passed by scalar value; structures, vectors and maps are passed by reference. Output parameters are passed as references to a scalar variable which will be modified to point to the returned value. If the method is declared to have a non-void return type the Perl method will return a single scalar value.</p>
<p>Examples:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># no parameters, no return value</span></div>
<div class="line"><span class="preprocessor"></span>$firmware-&gt;reboot();</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># two input parameters, integer return value</span></div>
<div class="line"><span class="preprocessor"></span>$ret = $user_manager-&gt;createAccount(<span class="stringliteral">&#39;newuser&#39;</span>, <span class="stringliteral">&#39;newpassword&#39;</span>);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># one output parameter, integer return value</span></div>
<div class="line"><span class="preprocessor"></span>my $results;</div>
<div class="line">$ret = $diagnostics-&gt;listTcpConnections(\$results);</div>
</div><!-- fragment --><h3>Structures</h3>
<p>IDL structures are mapped as scalar references to Perl hashes. Each element of the structure results in a hash entry whose key is the element identifier and whose value is a Perl scalar. When passing a structure to a method call addtional hash entries are ignored.</p>
<p>Example:</p>
<div class="fragment"><div class="line">$ssh_settings = {</div>
<div class="line">    <span class="stringliteral">&#39;allowPasswordAuth&#39;</span>  =&gt; 1,</div>
<div class="line">    <span class="stringliteral">&#39;allowPublicKeyAuth&#39;</span> =&gt; 0</div>
<div class="line">};</div>
<div class="line">$security-&gt;setSSHSettings($ssh_settings);</div>
</div><!-- fragment --><h3>Enumerations</h3>
<p>Enumerated values are referenced by their fully-qualified name:</p>
<div class="fragment"><div class="line">$ret = $outlet-&gt;setPowerState(Raritan::RPC::pdumodel::Outlet::PowerState::PS_ON);</div>
</div><!-- fragment --><h3>Vectors</h3>
<p>Vectors are mapped as scalar references to Perl lists. Each list entry must be a scalar.</p>
<div class="fragment"><div class="line">$recipients = [ <span class="stringliteral">&#39;somebody@invalid.com&#39;</span>, <span class="stringliteral">&#39;somebody.else@invalid.com&#39;</span> ];</div>
<div class="line">$smtp-&gt;testConfiguration($cfg, $recipients);</div>
</div><!-- fragment --><h3>Maps</h3>
<p>Maps are mapped as scalar references to Perl hashes:</p>
<div class="fragment"><div class="line">$priorities = {</div>
<div class="line">    <span class="stringliteral">&#39;important_client&#39;</span> =&gt; Raritan::RPC::webcam::Priority::VERY_HIGH,</div>
<div class="line">    <span class="stringliteral">&#39;other_client&#39;</span>     =&gt; Raritan::RPC::webcam::Priority::LOW</div>
<div class="line">};</div>
<div class="line">$ret = $webcam-&gt;setClientTypePriorities($priorities);</div>
</div><!-- fragment --><h2>Exceptions</h2>
<p>In case of error conditions during a proxy method call or the <code>createProxy</code> funtion exceptions will be thrown. They can be caught using the <code>try</code> statement from the <code>Perl::Error</code> module.</p>
<p>The following exceptions are defined:</p>
<ul>
<li><b><code>Raritan::RPC::HttpException</code> </b>  An error occured during HTTP communication, e.g. in case the connection was refused or the authentication failed. Please check the agent URL, the resource ID and your authentication credentials.</li>
<li><b><code>Raritan::RPC::JsonRpcSyntaxException</code> </b>  The response from the server was not a valid JSON object. Please check the agent URL and the resource ID.</li>
<li><b><code>Raritan::RPC::JsonRpcErrorException</code> </b>  The method call failed. This should not happen under normal circumstances and indicates a problem on the device.</li>
</ul>
<p>Example for catching an exception: </p>
<div class="fragment"><div class="line">use Raritan::RPC;</div>
<div class="line">use Error qw(:<span class="keywordflow">try</span>);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    print <span class="stringliteral">&quot;Querying firmware version ... &quot;</span>;</div>
<div class="line">    my $agent = <span class="keyword">new</span> Raritan::RPC::Agent(<span class="stringliteral">&#39;https://my-device.example.com&#39;</span>, <span class="stringliteral">&#39;admin&#39;</span>, <span class="stringliteral">&#39;raritan&#39;</span>);</div>
<div class="line">    my $firmware_proxy = $agent-&gt;createProxy(<span class="stringliteral">&#39;/firmware&#39;</span>);</div>
<div class="line">    my $version = $firmware_proxy-&gt;getVersion();</div>
<div class="line">    print <span class="stringliteral">&quot;Success\n&quot;</span>;</div>
<div class="line">    print <span class="stringliteral">&quot;Firmware version: $version\n&quot;</span>;</div>
<div class="line">} <span class="keywordflow">catch</span> Raritan::RPC::HttpException with {</div>
<div class="line">    my $e = shift;</div>
<div class="line">    print <span class="stringliteral">&quot;ERROR: &quot;</span>, $e;</div>
<div class="line">};</div>
</div><!-- fragment --><h2>Raritan::RPC::Agent Method Reference</h2>
<h3>Constructor: new Raritan::RPC::Agent($url, $user, $password)</h3>
<p>Creates a new agent.</p>
<p>Parameters:</p>
<ul>
<li><b>$url</b> Base URL of the device (e.g. "https://my-device.example.com")</li>
<li><b>$user</b> User Name (optional)</li>
<li><b>$password</b> Password (optional)</li>
</ul>
<h3>set_auth_basic($user, $password)</h3>
<p>This method enables HTTP basic authentication using username and password.</p>
<p>Parameters:</p>
<ul>
<li><b>$user</b> User Name (optional)</li>
<li><b>$password</b> Password (optional)</li>
</ul>
<h3>set_auth_token($token)</h3>
<p>This method enables HTTP authentication using a session token. A session token can be obtained by calling the newSession method of the session.SessionManager interface.</p>
<p>Parameters:</p>
<ul>
<li><b>$token</b> Session Token</li>
</ul>
<h3>timeout($seconds)</h3>
<p>Returns and optionally sets the request timeout.</p>
<p>Parameters:</p>
<ul>
<li><b>$seconds</b> New timeout in seconds (optional)</li>
</ul>
<p>Returns:</p>
<ul>
<li>Previous timeout in seconds</li>
</ul>
<h3>createProxy($rid, $basetype)</h3>
<p>Creates a new proxy object for the given resource id.</p>
<p>This method will query the type information for the specified resource ID and create a proxy object which provides all methods defined in the IDL definition.</p>
<p>When connecting to very old firmware versions (PX2 2.2 and earlier, EMX 2.0 and earlier) the type information of a resource ID cannot be queried. In this case the <b>$basetype</b> argument is required.</p>
<p>Parameters:</p>
<ul>
<li><b>$rid</b> The resource ID, e.g. "/auth/user/admin"</li>
<li><b>$basetype</b> The base type, e.g. "usermgmt.User" (optional)</li>
</ul>
<p>Returns:</p>
<ul>
<li>A new proxy object for the specified resource ID</li>
</ul>
<h3>set_verbose($verbose)</h3>
<p>Enables request tracing. When verbose mode is enabled all JSON-RPC requests and responses will be echoed to the console.</p>
<p>Parameters:</p>
<ul>
<li><b>$verbose</b> <code>true</code> to enable verbose mode </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 7 2016 12:57:02 for Raritan PX2/PX3 JSON-RPC API by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
